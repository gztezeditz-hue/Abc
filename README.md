<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>The Darpan Wears</title><style>:root{--accent:#9b5cf3;--accent2:#ff6bcb;--muted:#6b7280;--bg:#fff7fb}*{box-sizing:border-box}body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#111} .wrap{max-width:920px;margin:0 auto;padding:14px} header{display:flex;justify-content:space-between;align-items:center} .brand{font-weight:800;font-size:20px} .sub{font-size:12px;color:var(--muted)} .search{display:flex;gap:8px;margin:12px 0} input[type="search"]{flex:1;padding:10px;border-radius:8px;border:1px solid #e6e6e6} .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0} .cat{padding:8px 12px;border-radius:20px;background:#fff;border:1px solid #eee;font-weight:700;cursor:pointer} .cat.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border-color:transparent} .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:12px} .card{background:#fff;border-radius:12px;padding:10px;box-shadow:0 6px 20px rgba(0,0,0,0.05)} .thumb{width:100%;height:160px;object-fit:cover;border-radius:10px;background:#f4f4f4} .title{font-weight:800;margin:8px 0 4px} .muted{color:var(--muted);font-size:13px} .price{font-weight:800;color:#111} .btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:8px 10px;border-radius:10px;border:0;cursor:pointer;font-weight:700} .btn.out{background:#fff;color:#111;border:1px solid #eee} .adminBtn{background:#222;color:#fff;padding:8px 10px;border-radius:10px} footer{margin-top:18px;text-align:center;color:var(--muted);font-size:12px;padding:20px 0} .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:9999} .panel{background:#fff;border-radius:12px;padding:14px;width:94%;max-width:760px;max-height:92vh;overflow:auto} input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6;margin-top:8px} label{font-size:13px;color:#444} .small{font-size:13px;color:var(--muted)} .danger{background:#ff4d4f} @media(min-width:900px){.thumb{height:200px}}</style></head><body><div class="wrap"><header><div><div class="brand">The Darpan Wears</div><div class="sub">T-Shirts • Jeans • Jackets • Shoes • Electronic Gadgets</div></div><div><button id="adminOpen" class="adminBtn">Admin</button></div></header><div class="search"><input id="q" type="search" placeholder="Search product or category" /><button id="searchBtn" class="btn out">Search</button></div><div class="row" id="categories"></div><div class="grid" id="productsGrid"></div><footer>© The Darpan Wears — Orders via WhatsApp</footer></div><div id="modalRoot" style="display:none"></div><script type="module">/* FIREBASE CONFIG (fixed storageBucket) */const firebaseConfig={apiKey:"AIzaSyAyDVRXS20No4Rc5izqOW5v58UdjsVA4qk",authDomain:"darpanwears-11.firebaseapp.com",projectId:"darpanwears-11",storageBucket:"darpanwears-11.appspot.com",messagingSenderId:"1039363541288",appId:"1:1039363541288:web:97765ee722bd7d2ea4681d",measurementId:"G-40F1FM54C8"};import{initializeApp}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import{getFirestore,collection,addDoc,getDocs,onSnapshot,doc,updateDoc,deleteDoc,serverTimestamp}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";import{getStorage,ref as sRef,uploadBytes,getDownloadURL,deleteObject}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";const app=initializeApp(firebaseConfig);const db=getFirestore(app);const storage=getStorage(app);const CATEGORIES=[{id:"all",name:"All"},{id:"T-Shirts",name:"T-Shirts"},{id:"Jeans",name:"Jeans"},{id:"Jackets",name:"Jackets"},{id:"Shoes",name:"Shoes"},{id:"Electronic Gadgets",name:"Electronic Gadgets"}];const WA_NUMBER="+919332307996";const ADMIN_PW="darpan2008";let currentCategory="all";let products=[];const categoriesEl=document.getElementById("categories");const productsGrid=document.getElementById("productsGrid");const modalRoot=document.getElementById("modalRoot");const qInput=document.getElementById("q");const searchBtn=document.getElementById("searchBtn");const adminOpen=document.getElementById("adminOpen");function renderCategories(){categoriesEl.innerHTML="";CATEGORIES.forEach(c=>{const el=document.createElement("div");el.className="cat"+(c.id===currentCategory?" active":"");el.textContent=c.name;el.dataset.id=c.id;el.onclick=()=>{currentCategory=c.id;renderCategories();renderProducts()};categoriesEl.appendChild(el)})}async function loadProductsRealtime(){const col=collection(db,"products");onSnapshot(col,snapshot=>{products=[];snapshot.forEach(d=>products.push({id:d.id,...d.data()}));products.sort((a,b)=>{const ta=a.createdAt&&a.createdAt.seconds?a.createdAt.seconds:0;const tb=b.createdAt&&b.createdAt.seconds?b.createdAt.seconds:0;return tb-ta});renderProducts()})}function renderProducts(){const q=qInput.value.trim().toLowerCase();productsGrid.innerHTML="";const filtered=products.filter(p=>{if(currentCategory!=="all"&&(p.cat||p.category||"").toLowerCase()!==currentCategory.toLowerCase())return false;if(q){const inName=(p.name||"").toLowerCase().includes(q);const inDesc=(p.description||"").toLowerCase().includes(q);return inName||inDesc}return true});if(filtered.length===0){productsGrid.innerHTML='<div class="muted">No products found.</div>';return}filtered.forEach(p=>{const card=document.createElement("div");card.className="card";card.innerHTML=`<img class="thumb" src="${escapeHtml(p.img||p.image||'')}" alt="${escapeHtml(p.name||'')}" onerror="this.src='https://i.ibb.co/XfDVDtkZ/Output.jpg'"/><div class="title">${escapeHtml(p.name||'Untitled')}</div><div class="muted">${escapeHtml(p.cat||p.category||'')}</div><div class="price">₹ ${escapeHtml(p.price||'0')}</div><div style="margin-top:8px;display:flex;gap:8px"><button class="btn" onclick="orderProduct('${p.id}')">Order</button><button class="btn out" onclick="viewProduct('${p.id}')">View</button></div>`;productsGrid.appendChild(card)})}function escapeHtml(s){if(s==null)return"";return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}window.orderProduct=function(prodId){const p=products.find(x=>x.id===prodId);if(!p)return alert("Product not found");openOrderModal(p)};window.viewProduct=function(id){const p=products.find(x=>x.id===id);if(!p)return alert("Not found");alert(p.name+"\n\n"+(p.description||"")+"\n\nPrice: ₹"+(p.price||"0")+"\nCategory: "+(p.cat||p.category||""))};function openOrderModal(product){showModal(`<div class="panel"><h3>Order — ${escapeHtml(product.name)}</h3><div class="form-row"><label>Name</label><input id="ord_name" placeholder="Your name" /></div><div class="form-row"><label>Phone</label><input id="ord_phone" placeholder="Mobile number" /></div><div class="form-row"><label>State</label><input id="ord_state" placeholder="State" /></div><div class="form-row"><label>City</label><input id="ord_city" placeholder="City" /></div><div class="form-row"><label>Village</label><input id="ord_village" placeholder="Village / Area" /></div><div class="form-row"><label>Pincode</label><input id="ord_pin" placeholder="Pincode" /></div><div style="display:flex;gap:8px;margin-top:12px"><button id="confirmOrder" class="btn">Confirm & Send WhatsApp</button><button id="cancelOrder" class="btn danger">Cancel</button></div></div>`);document.getElementById("confirmOrder").onclick=async()=>{const name=document.getElementById("ord_name").value.trim();const phone=document.getElementById("ord_phone").value.trim();const state=document.getElementById("ord_state").value.trim();const city=document.getElementById("ord_city").value.trim();const village=document.getElementById("ord_village").value.trim();const pin=document.getElementById("ord_pin").value.trim();if(!name||!phone)return alert("Please enter name and phone");try{await addDoc(collection(db,"orders"),{productId:product.id,productName:product.name||"",price:product.price||"",customerName:name,phone,state,city,village,pin,createdAt:serverTimestamp()})}catch(e){console.error(e);alert("Failed to save order: "+e.message);return}const msg=encodeURIComponent(`New order from The Darpan Wears\nProduct: ${product.name}\nPrice: ₹${product.price}\nCustomer: ${name}\nPhone: ${phone}\nAddress: ${village}, ${city}, ${state} - ${pin}`);const wa=`https://wa.me/${WA_NUMBER.replace(/\D/g,'')}?text=${msg}`;window.open(wa,"_blank");hideModal()};document.getElementById("cancelOrder").onclick=hideModal}adminOpen.onclick=()=>{const pw=prompt("Enter admin password:");if(pw!==ADMIN_PW)return alert("Incorrect password");openAdminPanel()};async function openAdminPanel(){showModal(`<div class="panel"><h3>Admin Panel</h3><div class="form-row"><label>Product name</label><input id="adm_name" /></div><div class="form-row"><label>Category</label><select id="adm_cat"><option value="T-Shirts">T-Shirts</option><option value="Jeans">Jeans</option><option value="Jackets">Jackets</option><option value="Shoes">Shoes</option><option value="Electronic Gadgets">Electronic Gadgets</option></select></div><div class="form-row"><label>Price</label><input id="adm_price" type="number"/></div><div class="form-row"><label>Description</label><textarea id="adm_desc"></textarea></div><div class="form-row"><label>Sizes (comma separated)</label><input id="adm_sizes"/></div><div class="form-row"><label>Material</label><input id="adm_material"/></div><div class="form-row"><label>Image (choose file)</label><input id="adm_image" type="file" accept="image/*" /></div><div style="display:flex;gap:8px;margin-top:10px"><button id="addProductBtn" class="btn">Add Product</button><button id="refreshProducts" class="btn out">Refresh</button><button id="closeAdmin" class="btn danger">Close</button></div><hr/><h4>Products (click to edit)</h4><div id="adminProducts"></div><hr/><h4>Sales (orders count per product)</h4><div id="salesStats" class="small">Loading...</div></div>`);document.getElementById("closeAdmin").onclick=hideModal;document.getElementById("refreshProducts").onclick=fetchAndRenderProducts;document.getElementById("addProductBtn").onclick=async()=>{const name=document.getElementById("adm_name").value.trim();const price=Number(document.getElementById("adm_price").value);const desc=document.getElementById("adm_desc").value.trim();const sizes=document.getElementById("adm_sizes").value.trim();const material=document.getElementById("adm_material").value.trim();const category=document.getElementById("adm_cat").value;const file=document.getElementById("adm_image").files[0];if(!name||!price||!file)return alert("Please enter name, price and choose an image.");try{const path=`products/${Date.now()}_${file.name}`;const ref=sRef(storage,path);const snap=await uploadBytes(ref,file);const url=await getDownloadURL(snap.ref);await addDoc(collection(db,"products"),{name,price,description:desc,sizes,material,category,image:url,createdAt:serverTimestamp()});alert("Product added");document.getElementById("adm_name").value="";document.getElementById("adm_price").value="";document.getElementById("adm_desc").value="";document.getElementById("adm_sizes").value="";document.getElementById("adm_material").value="";document.getElementById("adm_image").value="";await fetchAndRenderProducts();renderAdminProducts();renderSalesStats()}catch(e){console.error(e);alert("Add failed: "+e.message)}};await renderAdminProducts();await renderSalesStats()}async function renderAdminProducts(){const adminProducts=document.getElementById("adminProducts");adminProducts.innerHTML="<div class='small'>Loading...</div>";const snap=await getDocs(collection(db,"products"));adminProducts.innerHTML="";snap.forEach(d=>{const p={id:d.id,...d.data()};const card=document.createElement("div");card.className="card";card.style.margin="8px 0";card.innerHTML=`<div style="display:flex;gap:12px;align-items:center"><img src="${escapeHtml(p.image||'')}" style="width:72px;height:72px;object-fit:cover;border-radius:8px"/><div style="flex:1"><div style="font-weight:700">${escapeHtml(p.name)}</div><div class="small">₹ ${escapeHtml(p.price||'')}</div><div class="small">${escapeHtml(p.category||'')}</div></div><div style="display:flex;flex-direction:column;gap:8px"><button class="btn" data-id="${p.id}" data-act="edit">Edit</button><button class="btn danger" data-id="${p.id}" data-act="del">Delete</button></div></div>`;adminProducts.appendChild(card)});adminProducts.querySelectorAll("button").forEach(btn=>{btn.onclick=async()=>{const id=btn.dataset.id;const act=btn.dataset.act;if(act==="del"){if(!confirm("Delete product?"))return;try{await deleteDoc(doc(db,"products",id));alert("Deleted");renderAdminProducts();await fetchAndRenderProducts();renderSalesStats()}catch(e){alert("Delete failed: "+e.message)}}else{openEditModal(id)}})}async function openEditModal(id){const p=products.find(x=>x.id===id);if(!p)return alert("Not found");showModal(`<div class="panel"><h3>Edit Product</h3><div class="form-row"><label>Name</label><input id="edt_name" value="${escapeHtml(p.name||'')}" /></div><div class="form-row"><label>Category</label><input id="edt_cat" value="${escapeHtml(p.category||'')}" /></div><div class="form-row"><label>Price</label><input id="edt_price" value="${escapeHtml(p.price||'')}" type="number" /></div><div class="form-row"><label>Description</label><textarea id="edt_desc">${escapeHtml(p.description||'')}</textarea></div><div class="form-row"><label>Image (optional replace)</label><input id="edt_image" type="file" accept="image/*" /></div><div style="display:flex;gap:8px;margin-top:10px"><button id="saveEdit" class="btn">Save</button><button id="closeEdit" class="btn danger">Close</button></div></div>`);document.getElementById("closeEdit").onclick=hideModal;document.getElementById("saveEdit").onclick=async()=>{try{const name=document.getElementById("edt_name").value.trim();const category=document.getElementById("edt_cat").value.trim();const price=Number(document.getElementById("edt_price").value||0);const desc=document.getElementById("edt_desc").value.trim();const file=document.getElementById("edt_image").files[0];let imageUrl=p.image;if(file){const path=`products/${Date.now()}_${file.name}`;const ref=sRef(storage,path);const snap=await uploadBytes(ref,file);imageUrl=await getDownloadURL(snap.ref)}await updateDoc(doc(db,"products",id),{name,category,price,description:desc,image:imageUrl});alert("Saved");hideModal();await fetchAndRenderProducts();renderAdminProducts()}catch(e){alert("Save failed: "+e.message)}}}async function renderSalesStats(){try{const snap=await getDocs(collection(db,"orders"));const counts={};snap.forEach(d=>{const pid=d.data().productId||"unknown";counts[pid]=(counts[pid]||0)+1});const parts=[];for(const pid in counts){const prod=products.find(p=>p.id===pid);parts.push(`${prod?prod.name:pid}: ${counts[pid]}`)}document.getElementById("salesStats").textContent=parts.length?parts.join(" | "):"No orders yet"}catch(e){document.getElementById("salesStats").textContent="Failed to load stats"}}async function fetchAndRenderProducts(){const snap=await getDocs(collection(db,"products"));products=snap.docs.map(d=>({id:d.id,...d.data()}));products.sort((a,b)=>(b.createdAt&&b.createdAt.seconds?b.createdAt.seconds:0)-(a.createdAt&&a.createdAt.seconds? a.createdAt.seconds:0));renderProducts()}function showModal(html){modalRoot.style.display="block";modalRoot.innerHTML=`<div class="modal">${html}</div>`}function hideModal(){modalRoot.style.display="none";modalRoot.innerHTML=""}searchBtn.onclick=()=>renderProducts();qInput.addEventListener("keypress",e=>{if(e.key==="Enter")renderProducts()});renderCategories();loadProductsRealtime();</script></body></html>
